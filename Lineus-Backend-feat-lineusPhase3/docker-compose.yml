services:
  mysql:
    image: mysql
    container_name: lineus-be-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: db_lineus
      MYSQL_USER: lineus
      MYSQL_PASSWORD: lineus
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "127.0.0.1", "-uroot", "-proot"]
      interval: 5s
      retries: 10
      start_period: 5s
    volumes:
      - mysql-data:/var/lib/mysql
    # Uses Docker's default bridge network (standard Docker networking)
    # No network_mode: host - containers communicate via service names
  mongodb:
    image: mongo:latest
    container_name: lineus-be-mongodb
    restart: always
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: root
      MONGO_INITDB_DATABASE: db_lineus
    volumes:
      - mongodb-data:/data/db
  redis:
    image: redis:latest
    container_name: lineus-be-redis
    restart: always
    volumes:
      - redis-data:/data
  webapp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: lineus-be-webapp
    restart: always
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    env_file:
      - .env.prod
    ports:
      - "8888:8080"
    depends_on:
      mysql:
        condition: service_healthy
      mongodb:
        condition: service_started
      redis:
        condition: service_started
volumes:
  mysql-data:
    driver: local
  mongodb-data:
  redis-data: